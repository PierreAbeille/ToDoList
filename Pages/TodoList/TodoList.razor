@page "/todolist"
@inject TodoService TodoService

<div class="filter-menu">
    <button @onclick="() => SetFilter(TodoFilter.All)">All</button>
    <button @onclick="() => SetFilter(TodoFilter.Active)">Active</button>
    <button @onclick="() => SetFilter(TodoFilter.Completed)">Completed</button>
</div>

<table class="table">
    <thead>
        <tr>
            <th>Done</th>
            <th>Title</th>
            <th>Description</th>
            <th>Due Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var todo in Todos)
        {
            <tr>
                <td><input type="checkbox" @bind="todo.IsDone" /></td>
                <td>@todo.Title</td>
                <td>@todo.Description</td>
                <td>
                    @if (todo.DueDate != null)
                        {
                            @todo.DueDate.ToString("dd/MM/yyyy")
                        }
                </td>
                <td><button @onclick="() => Remove(todo)">Remove</button></td>
            </tr>
        }
    </tbody>
</table>

@code {
            public List<TodoItem> Todos { get; set; }
            public TodoFilter CurrentFilter { get; set;}

            protected override void OnInitialized()
            {
                Todos = TodoService.GetAll();
                CurrentFilter = TodoFilter.All;
            }

            public void SetFilter(TodoFilter filter)
            {
                CurrentFilter = filter;
                Todos = TodoService.GetByFilter(CurrentFilter);
                StateHasChanged();
            }

            public void Remove(TodoItem todo)
            {
                Guid id = todo.Id;
                TodoService.Delete(id);

                Todos = TodoService.GetAll();
            }
}